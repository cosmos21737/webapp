{% extends "base.html" %}

{% block title %}æ¸¬å®šè¨˜éŒ² CSVä¸€æ‹¬ç™»éŒ² | é‡çƒéƒ¨ã‚¿ãƒ¬ãƒ³ãƒˆãƒãƒã‚¸ãƒ¡ãƒ³ãƒˆã‚·ã‚¹ãƒ†ãƒ {% endblock %}

{% block content %}
<div class="container fade-in">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>ğŸ“„ æ¸¬å®šè¨˜éŒ² CSVä¸€æ‹¬ç™»éŒ²</h1>
        <a href="{{ url_for('measurements.records_input') }}" class="btn btn-secondary">
            <span class="icon">âœï¸</span> å€‹åˆ¥å…¥åŠ›ã«æˆ»ã‚‹
        </a>
    </div>

    <div class="card p-4">
        <!-- Step 1: ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æº–å‚™ -->
        <div class="step-section">
            <div class="step-header">
                <span class="step-number">1</span>
                <h3 class="step-title">ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®æº–å‚™</h3>
            </div>
            <div class="step-content">
                <p>ä»¥ä¸‹ã®å½¢å¼ã«åˆã‚ã›ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã”ç”¨æ„ãã ã•ã„ã€‚ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ç·¨é›†ã™ã‚‹ã¨ä¾¿åˆ©ã§ã™ã€‚</p>
                <div class="csv-info">
                    <div class="csv-rules">
                        <h4>CSVãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ«ãƒ¼ãƒ«</h4>
                        <ul>
                            <li><span class="icon">ğŸ“</span> æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯ <strong>UTF-8</strong> ã§ä¿å­˜ã—ã¦ãã ã•ã„ã€‚</li>
                            <li><span class="icon">ğŸ‘¤</span> éƒ¨å“¡ã¯ã€Œå­¦å¹´ã€ã¨ã€Œæ°åã€ã§æ¤œç´¢ã—ã¾ã™ã€‚</li>
                            <li><span class="icon">ğŸ“…</span> æ¸¬å®šæ—¥ã¯ã€ŒYYYY/MM/DDã€ã¾ãŸã¯ã€ŒYYYY-MM-DDã€å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚</li>
                            {% if current_user.has_role("administer") %}
                            <li><span class="icon">âœ…</span> <strong>ç®¡ç†è€…ã®ã¿ï¼š</strong>æ‰¿èªçŠ¶æ…‹ã‚‚æŒ‡å®šã§ãã¾ã™ï¼ˆdraft, pending_coach, approved, rejectedï¼‰</li>
                            <div class="admin-status-explanation">
                                <h5>ğŸ“‹ æ‰¿èªçŠ¶æ…‹ã®è©³ç´°èª¬æ˜</h5>
                                <div class="status-details">
                                    <div class="status-detail">
                                        <div class="status-badge status-draft">draft</div>
                                        <p><strong>ä¸‹æ›¸ãï¼š</strong>ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒå…¥åŠ›ã—ãŸç›´å¾Œã®çŠ¶æ…‹ã€‚éƒ¨å“¡ã«ã‚ˆã‚‹ç¢ºèªãŒå¿…è¦ã§ã™ã€‚</p>
                                    </div>
                                    <div class="status-detail">
                                        <div class="status-badge status-pending">pending_coach</div>
                                        <p><strong>ã‚³ãƒ¼ãƒæ‰¿èªå¾…ã¡ï¼š</strong>éƒ¨å“¡ãŒæ‰¿èªã—ãŸè¨˜éŒ²ã€‚ã‚³ãƒ¼ãƒã«ã‚ˆã‚‹æœ€çµ‚æ‰¿èªãŒå¿…è¦ã§ã™ã€‚</p>
                                    </div>
                                    <div class="status-detail">
                                        <div class="status-badge status-approved">approved</div>
                                        <p><strong>æ‰¿èªæ¸ˆã¿ï¼š</strong>å…¨ã¦ã®æ‰¿èªãŒå®Œäº†ã—ãŸæ­£å¼ãªè¨˜éŒ²ã€‚åˆ†æã‚„çµ±è¨ˆã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚</p>
                                    </div>
                                    <div class="status-detail">
                                        <div class="status-badge status-rejected">rejected</div>
                                        <p><strong>å·®ã—æˆ»ã—ï¼š</strong>ä½•ã‚‰ã‹ã®ç†ç”±ã§å·®ã—æˆ»ã•ã‚ŒãŸè¨˜éŒ²ã€‚ä¿®æ­£å¾Œã«å†æå‡ºãŒå¿…è¦ã§ã™ã€‚</p>
                                    </div>
                                </div>
                                <div class="admin-usage-notes">
                                    <h6>ğŸ’¡ ä½¿ç”¨æ–¹æ³•</h6>
                                    <ul>
                                        <li><strong>é€šå¸¸ã®å…¥åŠ›ï¼š</strong>æ‰¿èªçŠ¶æ…‹ã‚’ç©ºæ¬„ã¾ãŸã¯ã€Œdraftã€ã«ã™ã‚‹ã¨ã€é€šå¸¸ã®æ‰¿èªãƒ•ãƒ­ãƒ¼ãŒé–‹å§‹ã•ã‚Œã¾ã™</li>
                                        <li><strong>å³åº§ã«æ‰¿èªæ¸ˆã¿ï¼š</strong>ã€Œapprovedã€ã‚’æŒ‡å®šã™ã‚‹ã¨ã€æ‰¿èªãƒ•ãƒ­ãƒ¼ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦å³åº§ã«æ­£å¼è¨˜éŒ²ã¨ã—ã¦ç™»éŒ²ã•ã‚Œã¾ã™</li>
                                        <li><strong>æ³¨æ„äº‹é …ï¼š</strong>ã€Œapprovedã€ã‚’æŒ‡å®šã™ã‚‹å ´åˆã¯ã€ååˆ†ã«ç¢ºèªã—ãŸã®ã¡ã«è¡Œã£ã¦ãã ã•ã„</li>
                                    </ul>
                                </div>
                            </div>
                            {% endif %}
                        </ul>
                    </div>
                </div>
                <div class="template-downloads">
                    <a href="{{ url_for('measurements.download_csv_template') }}" class="btn btn-primary mt-3">
                        <span class="icon">ğŸ“¥</span> ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </a>
                    {% if current_user.has_role("administer") %}
                    <a href="{{ url_for('measurements.download_admin_csv_template') }}" class="btn btn-warning mt-3 ms-2">
                        <span class="icon">ğŸ‘‘</span> ç®¡ç†è€…ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
                    </a>
                    <div class="admin-note mt-2">
                        <small class="text-muted">â€» ç®¡ç†è€…ç”¨ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã«ã¯æ‰¿èªçŠ¶æ…‹ã®åˆ—ãŒå«ã¾ã‚Œã¦ã„ã¾ã™</small>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <hr class="my-4">

        <form method="post" enctype="multipart/form-data">
            <!-- Step 2: ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ -->
            <div class="step-section">
                <div class="step-header">
                    <span class="step-number">2</span>
                    <h3 class="step-title">ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ</h3>
                </div>
                <div class="step-content">
                    <p>ä½œæˆã—ãŸCSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚</p>
                    <div class="form-group">
                        <label for="csv_file" class="form-label">CSVãƒ•ã‚¡ã‚¤ãƒ«</label>
                        <input type="file" id="csv_file" name="csv_file" class="form-control" accept=".csv" required>
                    </div>
                </div>
            </div>

            <hr class="my-4">

            <!-- Step 3: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ -->
            <div class="step-section">
                <div class="step-header">
                    <span class="step-number">3</span>
                    <h3 class="step-title">ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã¨ç™»éŒ²</h3>
                </div>
                <div class="step-content">
                    <p>ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã—ãŸã‚‰ã€ä¸‹ã®ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã—ã¾ã™ã€‚</p>
                    <div class="form-buttons mt-3">
                        <button type="submit" class="btn btn-success btn-lg">
                            <span class="icon">ğŸš€</span> ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦ç™»éŒ²
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</div>

<style>
.step-section {
    margin-bottom: 1.5rem;
}

.step-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    margin-bottom: 1rem;
}

.step-number {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    background-color: var(--primary-color);
    color: var(--white);
    border-radius: 50%;
    font-size: 1.25rem;
    font-weight: bold;
}

.step-title {
    color: var(--primary-color);
    margin: 0;
}

.step-content {
    padding-left: 3.5rem;
    border-left: 2px solid var(--gray-200);
    padding-bottom: 1rem;
}

.csv-info {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
    background-color: var(--gray-50);
    padding: 1rem;
    border-radius: var(--radius);
}

.csv-rules h4, .csv-example h4 {
    margin-bottom: 0.75rem;
    font-weight: 600;
}

.csv-rules ul {
    list-style: none;
    padding: 0;
    margin: 0;
}

.csv-rules li {
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.csv-example pre {
    background-color: var(--gray-800);
    color: var(--gray-100);
    padding: 1rem;
    border-radius: var(--radius-sm);
    font-size: 0.875rem;
    white-space: pre-wrap;
    word-break: break-all;
}

.form-buttons {
    display: flex;
    justify-content: center;
}

.btn .icon {
    margin-right: 0.5rem;
}

.template-downloads {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    align-items: center;
    margin-top: 1rem;
}

.admin-note {
    width: 100%;
    margin-top: 0.5rem;
}

.admin-note small {
    color: var(--warning);
    font-weight: 500;
}

/* ç®¡ç†è€…ç”¨æ‰¿èªçŠ¶æ…‹èª¬æ˜ã®ã‚¹ã‚¿ã‚¤ãƒ« */
.admin-status-explanation {
    margin-top: 1.5rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
    border: 2px solid var(--warning);
    border-radius: var(--radius);
    box-shadow: var(--shadow);
}

.admin-status-explanation h5 {
    color: var(--warning);
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.status-details {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.status-detail {
    display: flex;
    align-items: flex-start;
    gap: 0.75rem;
    padding: 0.75rem;
    background: var(--white);
    border-radius: var(--radius);
    border: 1px solid var(--gray-200);
    box-shadow: var(--shadow-sm);
}

.status-detail .status-badge {
    flex-shrink: 0;
    margin: 0;
}

.status-detail p {
    margin: 0;
    font-size: 0.9rem;
    line-height: 1.5;
    color: var(--gray-700);
}

.status-detail p strong {
    color: var(--gray-800);
    font-weight: 600;
}

.admin-usage-notes {
    background: var(--white);
    padding: 1rem;
    border-radius: var(--radius);
    border: 1px solid var(--gray-200);
}

.admin-usage-notes h6 {
    color: var(--primary-color);
    font-size: 1rem;
    font-weight: 600;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.admin-usage-notes ul {
    margin: 0;
    padding-left: 1.5rem;
}

.admin-usage-notes li {
    margin-bottom: 0.5rem;
    line-height: 1.6;
    color: var(--gray-700);
}

.admin-usage-notes li strong {
    color: var(--gray-800);
    font-weight: 600;
}

@media (max-width: 768px) {
    .csv-info {
        grid-template-columns: 1fr;
    }
    .step-content {
        padding-left: 0;
        border-left: none;
    }
    .template-downloads {
        flex-direction: column;
        align-items: stretch;
    }
    
    .template-downloads .btn {
        margin: 0.25rem 0;
    }
    .status-details {
        grid-template-columns: 1fr;
    }
    
    .status-detail {
        flex-direction: column;
        align-items: center;
        text-align: center;
        gap: 0.5rem;
    }
}
</style>
{% endblock %}