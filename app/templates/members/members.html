{% extends "base.html" %}

{% block title %}部員一覧{% endblock %}

{% block content %}
<h2>部員一覧</h2>

<nav>
    <ul>
        <li><a href="{{ url_for('members.new_member') }}" style="color: black;">新しいメンバーを登録</a></li>
        <li><a href="{{ url_for('members.csv_import') }}" style="color: black;">CSVで登録</a></li>
        <li><a href="{{ url_for('members.export_csv') }}" style="color: black;">CSV出力</a></li>
    </ul>
</nav>

<table id="memberTable" class="member-table display">
  <thead>
    <tr>
      <th>氏名</th>
      <th>学年</th>
      <th>活動状況</th>
    </tr>
  </thead>
  <tbody>
    {% for member in members %}
    <tr>
      <td><a href="{{ url_for('members.member_records', member_id=member.user_id) }}">{{ member.name }}</a></td>
      <td>{{ member.grade }}</td>
      <td>{% if member.is_active %}現役{% else %}引退{% endif %}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css">
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script> {# jQueryの読み込みを忘れずに #}
<script type="text/javascript" src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>

<script>
$(document).ready(function() {
    var table = $('#memberTable').DataTable({
        "pageLength": 10,
        "language": {
            "url": "https://cdn.datatables.net/plug-ins/1.10.25/i18n/Japanese.json"
        },
        // DataTablesが自動で列のインデックスを決定するため、
        // ソートボタンのインデックスと合わせる
        "columnDefs": [
            { "orderable": true, "targets": 0 }, // 氏名 (インデックス0)
            { "orderable": true, "targets": 1 }, // 学年 (インデックス1)
            { "orderable": true, "targets": 2 }  // 活動状況 (インデックス2)
        ]
    });

    // 各ボタンにクリックイベントを設定
    $('#sortByNameAsc').on('click', function() {
        table.order([0, 'asc']).draw(); // 氏名 (インデックス0) を昇順でソート
    });

    $('#sortByNameDesc').on('click', function() {
        table.order([0, 'desc']).draw(); // 氏名 (インデックス0) を降順でソート
    });

    $('#sortByGradeAsc').on('click', function() {
        table.order([1, 'asc']).draw(); // 学年 (インデックス1) を昇順でソート
    });

    $('#sortByGradeDesc').on('click', function() {
        table.order([1, 'desc']).draw(); // 学年 (インデックス1) を降順でソート
    });

    $('#sortByStatusAsc').on('click', function() {
        table.order([2, 'asc']).draw(); // 活動状況 (インデックス2) を昇順でソート
    });

    $('#sortByStatusDesc').on('click', function() {
        table.order([2, 'desc']).draw(); // 活動状況 (インデックス2) を降順でソート
    });
});
</script>
{% endblock %}