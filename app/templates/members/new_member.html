{% extends "base.html" %}

{% block title %}éƒ¨å“¡ç™»éŒ²{% endblock %}

{% block content %}
<div class="container fade-in">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>ğŸ‘¤ æ–°ã—ã„ãƒ¡ãƒ³ãƒãƒ¼ã‚’ç™»éŒ²</h2>
        <a href="{{ url_for('members.csv_import') }}" class="btn btn-secondary">
            <span class="icon">ğŸ“¥</span> CSVã§ä¸€æ‹¬ç™»éŒ²
        </a>
    </div>
    <div class="alert alert-warning mb-4">
        <strong>ã”æ³¨æ„ï¼š</strong><br>
        ãƒ»<strong>åˆæœŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã€Œpassword123ã€ã§ã™ã€‚</strong>ç™»éŒ²å¾Œã¯å¿…ãšå„è‡ªã§ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚
    </div>
    <div class="card p-4">
        <form action="{{ url_for('members.register_member') }}" method="post" id="memberForm">
            <div class="form-group mb-3">
                <label for="student_id" class="fw-bold">å­¦ç”Ÿç•ªå·:</label>
                <input type="text" id="student_id" name="student_id" class="form-control" placeholder="ä¾‹: S24001" maxlength="20" required>
            </div>
            <div class="form-group mb-3">
                <label for="name" class="fw-bold">æ°å:</label>
                <input type="text" id="name" name="name" class="form-control" required>
            </div>
            <div class="form-group mb-3">
                <label for="member_grade" class="fw-bold">å­¦å¹´ï¼ˆå­¦ç”Ÿã®å ´åˆï¼‰:</label>
                <select id="member_grade" name="member_grade" class="form-control" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value=1>1å¹´</option>
                    <option value=2>2å¹´</option>
                    <option value=3>3å¹´</option>
                    <option value="">å­¦ç”Ÿä»¥å¤–</option>
                </select>
            </div>
            <div class="form-group mb-4">
                <label for="member_role" class="fw-bold">å½¹å‰²:</label>
                <select id="member_role" name="member_role" class="form-control" required>
                    <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                    <option value="member">éƒ¨å“¡</option>
                    <option value="manager">ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼</option>
                    <option value="coach">ã‚³ãƒ¼ãƒ</option>
                    <option value="director">é¡§å•</option>
                </select>
            </div>
            <div id="validation-error" class="alert alert-danger mb-3" style="display: none;">
                <span id="error-message"></span>
            </div>
            <div class="form-buttons d-flex justify-content-center">
                <button type="submit" class="btn btn-primary btn-lg" id="submit-btn">ç™»éŒ²</button>
            </div>
        </form>
    </div>
    <div class="mt-4">
        <a href="{{ url_for('members.members') }}" class="btn btn-outline-secondary">
            <span class="icon">ğŸ“œ</span> éƒ¨å“¡ä¸€è¦§ã«æˆ»ã‚‹
        </a>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('memberForm');
    const gradeSelect = document.getElementById('member_grade');
    const roleSelect = document.getElementById('member_role');
    const errorDiv = document.getElementById('validation-error');
    const errorMessage = document.getElementById('error-message');
    const submitBtn = document.getElementById('submit-btn');

    function validateForm() {
        const grade = gradeSelect.value;
        const role = roleSelect.value;
        let isValid = true;
        let errorMsg = '';

        // å½¹å‰²ã¨å­¦å¹´ã®çµ„ã¿åˆã‚ã›ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
        if (role === 'member' || role === 'manager') {
            // éƒ¨å“¡ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®å ´åˆã¯å­¦å¹´ãŒé¸æŠã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹
            if (!grade || grade === '') {
                errorMsg = 'éƒ¨å“¡ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®å ´åˆã¯å­¦å¹´ã‚’é¸æŠã—ã¦ãã ã•ã„';
                isValid = false;
            }
        } else if (role === 'coach' || role === 'director') {
            // ã‚³ãƒ¼ãƒãƒ»ç›£ç£ã®å ´åˆã¯å­¦å¹´ãŒé¸æŠã•ã‚Œã¦ã„ãªã„å¿…è¦ãŒã‚ã‚‹
            if (grade && grade !== '') {
                errorMsg = 'ã‚³ãƒ¼ãƒãƒ»ç›£ç£ã®å ´åˆã¯å­¦å¹´ã‚’é¸æŠã—ãªã„ã§ãã ã•ã„';
                isValid = false;
            }
        }

        // ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¡¨ç¤º/éè¡¨ç¤º
        if (!isValid) {
            errorMessage.textContent = errorMsg;
            errorDiv.style.display = 'block';
            submitBtn.disabled = true;
        } else {
            errorDiv.style.display = 'none';
            submitBtn.disabled = false;
        }

        return isValid;
    }

    // ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡æ™‚ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    form.addEventListener('submit', function(e) {
        if (!validateForm()) {
            e.preventDefault();
        }
    });

    // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    gradeSelect.addEventListener('change', validateForm);
    roleSelect.addEventListener('change', validateForm);
});
</script>
{% endblock %}