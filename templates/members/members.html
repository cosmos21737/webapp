{% extends "base.html" %}

{% block title %}部員一覧{% endblock %}

{% block content %}
<h2>部員一覧</h2>

<nav>
    <ul>
        <li><a href="{{ url_for('members.new_member') }}" style="color: black;">新しい部員を登録</a></li>
        <li><a href="{{ url_for('members.export_csv') }}" style="color: black;">CSV出力</a></li>
    </ul>
</nav>

<table class="member-table">
  <thead>
    <tr>
      <th>
        <a href="{{ url_for('members.members', sort_by='name', sort_order=('desc' if sort_by == 'name' and sort_order == 'asc' else 'asc'), sort_flag=True) }}">
          氏名 {% if sort_by == 'name' %}({{ '↑' if sort_order == 'asc' else '↓' }}){% endif %}
        </a>
      </th>
      <th>
        <a href="{{ url_for('members.members', sort_by='grade', sort_order=('desc' if sort_by == 'grade' and sort_order == 'asc' else 'asc'), sort_flag=True) }}">
          学年 {% if sort_by == 'grade' %}({{ '↑' if sort_order == 'asc' else '↓' }}){% endif %}
        </a>
      </th>
      <th>
        <a href="{{ url_for('members.members', sort_by='status', sort_order=('desc' if sort_by == 'status' and sort_order == 'asc' else 'asc'), sort_flag=True) }}">
          活動状況 {% if sort_by == 'status' %}({{ '↑' if sort_order == 'asc' else '↓' }}){% endif %}
        </a>
      </th>
    </tr>
  </thead>
  <tbody>
    {% for member in members %}
    <tr>
      <td><a href="{{ url_for('members.member_records', member_id=member.user_id) }}">{{ member.name }}</a></td>
      <td>{{ member.grade }}</td>
      <td>{% if member.is_active %}現役{% else %}引退{% endif %}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<!-- ページネーション -->
<div class="pagination">
    {% if pagination.has_prev %}
        <a href="{{ url_for('members.members', page=pagination.prev_num, sort_by=sort_by, sort_order=sort_order) }}">前へ</a>
    {% endif %}

    {% for page_num in pagination.iter_pages() %}
        {% if page_num %}
            {% if page_num == pagination.page %}
                <strong>{{ page_num }}</strong>
            {% else %}
                <a href="{{ url_for('members.members', page=page_num, sort_by=sort_by, sort_order=sort_order) }}">{{ page_num }}</a>
            {% endif %}
        {% else %}
            <span class="ellipsis">…</span>
        {% endif %}
    {% endfor %}

    {% if pagination.has_next %}
        <a href="{{ url_for('members.members', page=pagination.next_num, sort_by=sort_by, sort_order=sort_order) }}">次へ</a>
    {% endif %}
</div>

<div class="sort-help">
    <p>※各項目をクリックするとソートできます。同じ項目を再度クリックすると昇順/降順が切り替わります。</p>
</div>
{% endblock %}